<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.anders.vote.mapper.PollMapper">
	<resultMap id="pollMap" type="com.anders.vote.bo.Poll">
	    <id column="id" property="id" jdbcType="BIGINT" />
	    <result column="title" property="title" jdbcType="VARCHAR" />
	    <result column="remark" property="remark" jdbcType="VARCHAR" />
	    <result column="enabled" property="enabled" jdbcType="BIT" />
    	<collection property="pollItems" javaType="ArrayList" ofType="com.anders.vote.bo.PollItem" resultMap="pollItemMap" />
	</resultMap>
	
	<resultMap id="pollItemMap" type="com.anders.vote.bo.PollItem">
		<id column="item_id" property="id" jdbcType="BIGINT" />
		<result column="item_title" property="title" jdbcType="VARCHAR" />
		<result column="item_enabled" property="enabled" jdbcType="BIT" />
	</resultMap>
	
	<select id="getById" resultMap="pollMap">
    	select * from tb_poll where id = #{id} and enabled = true
  	</select>
  	
	<select id="getAll" resultMap="pollMap">
    	select * from tb_poll where enabled = true
  	</select>
  	
	<select id="findById" resultMap="pollMap">
    	select * from tb_poll where id = #{id} 
  	</select>
  	
	<select id="findAll" resultMap="pollMap">
    	select * from tb_poll
  	</select>
  	
	<insert id="save" parameterType="com.anders.vote.bo.Poll" useGeneratedKeys="true" keyProperty="id">
	    insert into tb_poll (title, remark) values (#{title}, #{remark})
	</insert>
	
	<update id="update" parameterType="com.anders.vote.bo.Poll">
	    update tb_poll set title = #{title}, remark = #{remark}, enabled = #{enabled} where id = #{id}
	</update>
	
	<update id="disabledById">
    	update tb_poll set enabled = false where id = #{id} and enabled = true
  	</update>
  	
	<update id="disabled" parameterType="com.anders.vote.bo.Poll">
    	update tb_poll set enabled = false where id = #{id} and enabled = true
  	</update>
	
	<delete id="deleteById">
    	delete from tb_poll where id = #{id}
  	</delete>
  	
	<delete id="delete" parameterType="com.anders.vote.bo.Poll">
    	delete from tb_poll where id = #{id}
  	</delete>
</mapper>